---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: powerdns
  namespace: dns-system
spec:
  interval: 15m
  chart:
    spec:
      chart: .
      sourceRef:
        kind: GitRepository
        name: cdwv-powerdns
        namespace: dns-system
      interval: 15m
  values:
    # PowerDNS configuration
    pdns:
      api:
        enabled: true
      webserver:
        allowFrom: "10.0.0.0/8,172.16.0.0/12,192.168.0.0/16"
      dnsupdate:
        enabled: false

    # Use single replica for DNS consistency
    replicaCount: 1

    # Service configuration
    service:
      type: LoadBalancer
      annotations:
        metallb.universe.tf/address-pool: dns-pool
        metallb.universe.tf/loadBalancerIPs: 10.0.3.3

    # Disable ingress (we don't need web UI exposed)
    ingress:
      enabled: false

    # MariaDB configuration (backend database)
    mariadb:
      master:
        persistence:
          enabled: true
          accessModes:
            - ReadWriteOnce
          size: 2Gi
      metrics:
        enabled: false
